extends ../layout
block imports-main
  link(type="text/css" rel="stylesheet" href="/static/main/collection/style.css")
  script(src="/static/main/collection/script.js" defer)

block content-main
  - var currentRoute = `/main/${databaseName}/${collection.name}`
  .row
    .col-auto
      a(href=`/main/${databaseName}`)
        .back-button Go Back
  form(id="col-form" method="GET")
    .row
      h4.col= collection.name.prettyTitleCase()
    .row
      .col-auto
        button.filter-but(type="submit") Apply filters
      .col-auto
        button.filter-but(formaction=`${currentRoute}/reset/1` type="submit") Reset filters
    .row
      .col-12
    .row.flex-nowrap.document-container
      if collection.documents.length <= 0
        .col No results
      each field in collection.fieldList
        .col.field-doc-col
          .row
            .col-12.container-cell.document-field= field.key.prettyTitleCase()
            .col-12
              - var inputVal = inputValues[field.key];
              - var sortPrefix = "sort--"
              - var inputSortVal = inputValues[sortPrefix + field.key];
              input(name=`${field.key}` type="text" value=`${inputVal?inputVal:''}`)
            div(class=`col-12 sort-arrow align-self-center sort${inputSortVal}`)
              input(id=`${sortPrefix + field.key}` class="sort-input" name=`${sortPrefix + field.key}` type="hidden" value=`${inputSortVal?inputSortVal:''}`)
              span.sort-function.sort-asc(onclick=`sort('${field.key}', -1)`)
                i.fas.fa-arrow-up
              span.sort-function.sort-desc(onclick=`sort('${field.key}', 1)`)
                i.fas.fa-arrow-down
          each document in collection.documents
            .row
              - var keyValue = document[field.key];
              if field.key === '_id'
                a(href=`${currentRoute}/${keyValue}`)
                  .col-12.container-cell.document-id= keyValue
              else
                if keyValue && (!Array.isArray(keyValue) || (Array.isArray(keyValue) && keyValue.length > 0))
                  .col-12.document-value.container-cell= keyValue
                else
                  .col-12.document-value.container-cell.no-value No value
    .row.paginate-buttons
      - var disabledPrevious = inputValues.page==0 || !inputValues.page
      - var disabledNext = collection.documents.length < 30
      .col-auto
        button.paginate-but(formmethod="GET"
         formaction=`${currentRoute}/page/${(Number(inputValues.page)-1)}` type="submit" disabled=disabledPrevious) Previous 30
      .col-auto
        button.paginate-but(formmethod="GET"
         formaction=`${currentRoute}/page/${(Number(inputValues.page)+1)}` type="submit" disabled=disabledNext) Next 30